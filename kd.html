<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¿«é€’ä¸è®¢å•å½•å…¥</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 20px;
      background-color: #f2f2f2;
    }
    h2 { text-align: center; }
    label { display: block; margin-top: 16px; font-weight: bold; }
    input, select, button {
      width: 100%; padding: 12px; font-size: 1rem; margin-top: 5px; box-sizing: border-box;
    }
    .input-group { display: flex; flex-direction: column; flex: 1; min-width: 0; }
    .input-row { display: flex; gap: 16px; width: 100%; flex-wrap: wrap; box-sizing: border-box; }
    .input-group input, .input-group select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
      padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px;
      height: 42px; background-color: #fff;
    }
    .input-group select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="5"><polygon points="0,0 10,0 5,5" fill="%23333"/></svg>');
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 10px 5px;
      padding-right: 30px;
    }
    .input-row.three-cols {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
.btn-group {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-top: 24px;
}
    button.submit {
  font-size: 1.1rem;
  padding: 6px 10px;
  width: auto;
  min-width: 42px;
      border: none;
      color: white;
      border-radius: 6px;
    }
    .express { background: #28a745; }
    .order { background: #007acc; }
    .clear { background: #999; color: #fff; }
    button:hover { opacity: 0.9; cursor: pointer; }

    .form-container {
      max-width: 640px;
      margin: auto;
      background: #fffdf7;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .modal-mask {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal-box {
      background: #fff;
      padding: 24px;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
  </style>

<style>
  .clear-icon {
    position: absolute;
    top: 12px;
    right: 16px;
    font-size: 20px;
    cursor: pointer;
    z-index: 10;
    color: #888;
  }
  .clear-icon:hover {
    color: #d33;
  }
  .form-wrapper {
    position: relative;
  }
</style>

</head>
<body>
  <div class="form-wrapper">
  <div class="clear-icon" onclick="clearForm()" title="æ¸…ç©ºè¡¨å•">ğŸ§¹</div>
  <div class="form-container">
    <h2>ğŸ“¦ å¿«é€’ä¸è®¢å•ç»Ÿä¸€å½•å…¥</h2>
    <div class="input-row">
      <div class="input-group">
        <label for="orderNumber">è®¢å•å·</label>
        <input type="text" id="orderNumber">
      </div>
      <div class="input-group">
        <label for="customer">å®¢æˆ·åç§°</label>
        <select id="customer">
          <option value="">è¯·é€‰æ‹©å®¢æˆ·</option>
          <option value="å’ªé›ª">å’ªé›ª</option>
          <option value="Annie">Annie</option>
          <option value="HKS">HKS</option>
          <option value="JFL">JFL</option>
          <option value="é¾™">é¾™</option>
          <option value="æƒ ">æƒ </option>
          <option value="å§">å§</option>
          <option value="é˜¿å¦¹">é˜¿å¦¹</option>
          <option value="è‡ªå·±">è‡ªå·±</option>
          <option value="é˜¿æ–°">é˜¿æ–°</option>
          <option value="é—ºèœœ">é—ºèœœ</option>
        </select>
      </div>
    </div>
    <div class="input-row">
      <div class="input-group">
        <label for="trackingNumber">å¿«é€’å•å·</label>
        <input type="text" id="trackingNumber">
      </div>
      <div class="input-group">
        <label for="company">å¿«é€’å…¬å¸</label>
        <select id="company">
          <option value="">è¯·é€‰æ‹©å¿«é€’å…¬å¸</option>
          <option value="é¡ºä¸°">é¡ºä¸°</option>
          <option value="åœ†é€š">åœ†é€š</option>
          <option value="ä¸­é€š">ä¸­é€š</option>
          <option value="ç”³é€š">ç”³é€š</option>
          <option value="é‚®æ”¿">é‚®æ”¿</option>
          <option value="éŸµè¾¾">éŸµè¾¾</option>
          <option value="å¾·é‚¦">å¾·é‚¦</option>
          <option value="å®‰èƒ½">å®‰èƒ½</option>
          <option value="æå…”">æå…”</option>
          <option value="äº¬å¹¿">äº¬å¹¿</option>
          <option value="ä¼˜é€Ÿ">ä¼˜é€Ÿ</option>
          <option value="äº¬ä¸œ">äº¬ä¸œ</option>
          <option value="EMS">EMS</option>
        </select>
      </div>
    </div>
    <div class="input-row">
      <div class="input-group">
        <label for="product">å•†å“å</label>
        <input type="text" id="product">
      </div>
    </div>
    <div class="input-row three-cols">
      <div class="input-group">
        <label for="quantity">æ•°é‡</label>
        <input type="number" id="quantity">
      </div>
      <div class="input-group">
        <label for="price">å•ä»·</label>
        <input type="number" id="price">
      </div>
      <div class="input-group">
        <label for="foreignShipping">å¿«é€’è´¹</label>
        <input type="number" id="foreignShipping">
      </div>
    </div>
  <div id="summary" style="margin-top: 18px; font-weight: bold; text-align: right;">
    å°è®¡: <span id="subtotal">0.00</span>  | æ€»è®¡: <span id="total">0.00</span>
  </div>
  <div class="btn-group">
    <button class="submit" title="ç¼“å­˜å¿«é€’" onclick="cacheExpress()">ğŸ’¾</button>
    <button class="submit" title="æŸ¥çœ‹å¿«é€’ç¼“å­˜" onclick="previewExpressCache()">ğŸ‘ï¸</button>
    <button class="submit" title="ç¼“å­˜è®¢å•" onclick="cacheOrder()">ğŸ’¾</button>
    <button class="submit" title="æŸ¥çœ‹è®¢å•ç¼“å­˜" onclick="previewOrderCache()">ğŸ‘ï¸</button>
   </div>
  <div class="btn-group">
    <button class="submit" title="ä¸Šä¼ å¿«é€’è‰ç¨¿" onclick="uploadCachedExpress()">ğŸ“¤</button>
    <button class="submit" title="ä¸‹è½½å¿«é€’è‰ç¨¿" onclick="downloadCachedExpress()">ğŸ“¥</button>
    <button class="submit" title="ä¸Šä¼ è®¢å•è‰ç¨¿" onclick="uploadCachedOrders()">ğŸ“¤</button>
    <button class="submit" title="ä¸‹è½½è®¢å•è‰ç¨¿" onclick="downloadCachedOrders()">ğŸ“¥</button>
    
  </div>
</div>
<!-- âœ… å¿«é€’ç¼“å­˜å¼¹çª— -->
  <div id="expressCacheModal" class="modal-mask">
    <div class="modal-box">
      <h3>ğŸ“¦ ç¼“å­˜å¿«é€’é¢„è§ˆ</h3>
      <form id="expressCacheForm">
        <ul id="expressCacheList" style="list-style:none; padding-left:0;"></ul>
        <div style="margin-top:20px; text-align:right;">
          <button type="button" onclick="submitSelectedExpresses()">âœ… æäº¤æ‰€é€‰</button>
          <button type="button" onclick="closeExpressModal()">å…³é—­</button>
        </div>
      </form>
    </div>
  </div>
  <!-- âœ… è®¢å•ç¼“å­˜å¼¹çª— -->
  <div id="orderCacheModal" class="modal-mask">
    <div class="modal-box">
      <h3>ğŸ§¾ ç¼“å­˜è®¢å•é¢„è§ˆ</h3>
      <form id="orderCacheForm">
        <ul id="orderCacheList" style="list-style:none; padding-left:0;"></ul>
        <div style="margin-top:20px; text-align:right;">
          <button type="button" onclick="submitSelectedOrders()">âœ… æäº¤æ‰€é€‰</button>
          <button type="button" onclick="closeOrderModal()">å…³é—­</button>
        </div>
      </form>
    </div>
  </div>
  <script>
const EXPRESS_URL = "https://wandering-moon-bdc2.jeenty.workers.dev/gas3";
const ORDER_URL = "https://wandering-moon-bdc2.jeenty.workers.dev/gas4";
function getField(id) {
  return document.getElementById(id)?.value.trim() || '';
}
function setField(id, val) {
  const el = document.getElementById(id);
  if (el) el.value = val;
}
function parseOrZero(val) {
  return parseFloat(val) || 0;
}
function calculateTotal(quantity, price, foreignShipping, customer) {
  const subtotal = quantity * price + foreignShipping;
  const markupMap = {
    "å’ªé›ª": 0.10, "Annie": 0.19, "HKS": 0.16, "JFL": 0.19,
    "é¾™": 0.00, "æƒ ": 0.00, "å§": 0.01, "é˜¿å¦¹": 0.01,
    "è‡ªå·±": 0.00, "é˜¿æ–°": 0.00, "é—ºèœœ": 0.15
  };
  const markupRate = markupMap[customer] || 0;
  const total = (subtotal / 1.6) * (1 + markupRate);
  return {
    subtotal: subtotal.toFixed(2),
    total: total.toFixed(2)
  };
}
function updateSummary() {
  const quantity = parseOrZero(getField("quantity"));
  const price = parseOrZero(getField("price"));
  const fee = parseOrZero(getField("foreignShipping"));
  const customer = getField("customer");
  const subtotal = quantity * price + fee;
  const markupMap = {
    "å’ªé›ª": 0.10, "Annie": 0.19, "HKS": 0.16, "JFL": 0.19,
    "é¾™": 0.00, "æƒ ": 0.00, "å§": 0.01, "é˜¿å¦¹": 0.01,
    "è‡ªå·±": 0.00, "é˜¿æ–°": 0.00, "é—ºèœœ": 0.15
  };
  const markupRate = markupMap[customer] || 0;
  const total = (subtotal / 1.6) * (1 + markupRate);
  document.getElementById("subtotal").textContent = subtotal.toFixed(2);
  document.getElementById("total").textContent = total.toFixed(2);
}
function submitAsExpress() {
  const data = {
    customer: getField("customer"),
    orderNumber: getField("orderNumber"),
    trackingNumber: getField("trackingNumber"),
    company: getField("company"),
    product: getField("product")
  };
  const qty = parseOrZero(getField("quantity"));
  const price = parseOrZero(getField("price"));
  const fee = parseOrZero(getField("foreignShipping"));
  const { total } = calculateTotal(qty, price, fee, data.customer);
  data.total = total;
  fetch(EXPRESS_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(r => alert(r.message || "å¿«é€’ä¿¡æ¯æäº¤æˆåŠŸ"))
  .catch(() => alert("æäº¤å¤±è´¥"));
}
function submitAsOrder() {
  const data = {
    customer: getField("customer"),
    orderNumber: getField("orderNumber"),
    trackingNumber: getField("trackingNumber"),
    product: getField("product"),
    quantity: getField("quantity"),
    price: getField("price"),
    foreignShipping: getField("foreignShipping")
  };
  const qty = parseOrZero(data.quantity);
  const price = parseOrZero(data.price);
  const fee = parseOrZero(data.foreignShipping);
  const { subtotal, total } = calculateTotal(qty, price, fee, data.customer);
  data.subtotal = subtotal;
  data.total = total;
  if (!confirm(`ç¡®è®¤æäº¤è®¢å•ï¼Ÿ
æ•°é‡: ${qty} Ã— å•ä»·: ${price}
è¿è´¹: ${fee}
å°è®¡: ${data.subtotal}
æŠ˜ç®—æ€»è®¡: ${data.total}`)) return;
  fetch(ORDER_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(r => alert(r.message || "è®¢å•ä¿¡æ¯æäº¤æˆåŠŸ"))
  .catch(() => alert("æäº¤å¤±è´¥"));
}
function clearForm() {
  document.querySelectorAll("input, select").forEach(el => el.value = "");
  updateSummary();
}
["quantity", "price", "foreignShipping", "customer"].forEach(id => {
  document.getElementById(id).addEventListener("input", updateSummary);
  document.getElementById(id).addEventListener("change", updateSummary);
});
const ORDER_CACHE_KEY = "orderCache";
const EXPRESS_CACHE_KEY = "expressCache";
function cacheOrder() {
  const data = {
    customer: getField("customer"),
    orderNumber: getField("orderNumber"),
    trackingNumber: getField("trackingNumber"),
    product: getField("product"),
    quantity: getField("quantity"),
    price: getField("price"),
    foreignShipping: getField("foreignShipping")
  };
  let list = JSON.parse(localStorage.getItem(ORDER_CACHE_KEY) || "[]");
  list.push(data);
  localStorage.setItem(ORDER_CACHE_KEY, JSON.stringify(list));
  alert("å·²ç¼“å­˜å½“å‰è®¢å• âœ…");
}
function previewOrderCache() {
  const list = JSON.parse(localStorage.getItem(ORDER_CACHE_KEY) || "[]");
  const container = document.getElementById("orderCacheList");
  if (!list.length) return alert("æš‚æ— ç¼“å­˜è®¢å•");
  container.innerHTML = list.map((item, i) => `
    <li>
      <label><input type='checkbox' name='orderIndex' value='${i}'>
      è®¢å•: ${item.orderNumber} (${item.customer})</label>
      <button type='button' onclick='editOrderCache(${i})'>âœï¸ ä¿®æ”¹</button>
      <button type='button' onclick='deleteOrderCache(${i})'>ğŸ—‘ï¸ åˆ é™¤</button>
    </li>`).join("");
  document.getElementById("orderCacheModal").style.display = "flex";
}
function closeOrderModal() {
  document.getElementById("orderCacheModal").style.display = "none";
}
function submitSelectedOrders() {
  const selected = [...document.querySelectorAll("input[name='orderIndex']:checked")].map(el => parseInt(el.value));
  let list = JSON.parse(localStorage.getItem(ORDER_CACHE_KEY) || "[]");
  let success = [];
  let promises = selected.map(i => {
    const item = list[i];
    const { subtotal, total } = calculateTotal(parseOrZero(item.quantity), parseOrZero(item.price), parseOrZero(item.foreignShipping), item.customer);
    return fetch(ORDER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...item, subtotal, total })
    }).then(res => res.json()).then(r => {
      if (r.message?.includes("æˆåŠŸ")) success.push(i);
    });
  });
  Promise.all(promises).then(() => {
    list = list.filter((_, i) => !success.includes(i));
    localStorage.setItem(ORDER_CACHE_KEY, JSON.stringify(list));
    closeOrderModal();
    alert(`æˆåŠŸæäº¤ ${success.length} æ¡è®¢å• âœ…`);
  });
}
function deleteOrderCache(index) {
  let list = JSON.parse(localStorage.getItem(ORDER_CACHE_KEY) || "[]");
  list.splice(index, 1);
  localStorage.setItem(ORDER_CACHE_KEY, JSON.stringify(list));
  previewOrderCache();
}
function editOrderCache(index) {
  const list = JSON.parse(localStorage.getItem(ORDER_CACHE_KEY) || "[]");
  const item = list[index];
  if (!item) return;
  setField("customer", item.customer);
  setField("orderNumber", item.orderNumber);
  setField("trackingNumber", item.trackingNumber);
  setField("product", item.product);
  setField("quantity", item.quantity);
  setField("price", item.price);
  setField("foreignShipping", item.foreignShipping);
  deleteOrderCache(index);
  closeOrderModal();
}
function cacheExpress() {
  const data = {
    customer: getField("customer"),
    orderNumber: getField("orderNumber"),
    trackingNumber: getField("trackingNumber"),
    company: getField("company"),
    product: getField("product"),
    quantity: getField("quantity"),
    price: getField("price"),
    foreignShipping: getField("foreignShipping")
  };
  let list = JSON.parse(localStorage.getItem(EXPRESS_CACHE_KEY) || "[]");
  list.push(data);
  localStorage.setItem(EXPRESS_CACHE_KEY, JSON.stringify(list));
  alert("å¿«é€’ä¿¡æ¯å·²ç¼“å­˜ âœ…");
}
function previewExpressCache() {
  const list = JSON.parse(localStorage.getItem(EXPRESS_CACHE_KEY) || "[]");
  const container = document.getElementById("expressCacheList");
  if (!list.length) return alert("æš‚æ— ç¼“å­˜å¿«é€’");
  container.innerHTML = list.map((item, i) => `
    <li>
      <label><input type='checkbox' name='expressIndex' value='${i}'>
      å¿«é€’: ${item.trackingNumber} (${item.customer})</label>
      <button type='button' onclick='editExpressCache(${i})'>âœï¸ ä¿®æ”¹</button>
      <button type='button' onclick='deleteExpressCache(${i})'>ğŸ—‘ï¸ åˆ é™¤</button>
    </li>`).join("");
  document.getElementById("expressCacheModal").style.display = "flex";
}
function closeExpressModal() {
  document.getElementById("expressCacheModal").style.display = "none";
}
function submitSelectedExpresses() {
  const selected = [...document.querySelectorAll("input[name='expressIndex']:checked")].map(el => parseInt(el.value));
  let list = JSON.parse(localStorage.getItem(EXPRESS_CACHE_KEY) || "[]");
  let success = [];
  let promises = selected.map(i => {
    const item = list[i];
    const { total } = calculateTotal(parseOrZero(item.quantity), parseOrZero(item.price), parseOrZero(item.foreignShipping), item.customer);
    return fetch(EXPRESS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...item, total })
    }).then(res => res.json()).then(r => {
      if (r.message?.includes("æˆåŠŸ")) success.push(i);
    });
  });
  Promise.all(promises).then(() => {
    list = list.filter((_, i) => !success.includes(i));
    localStorage.setItem(EXPRESS_CACHE_KEY, JSON.stringify(list));
    closeExpressModal();
    alert(`æˆåŠŸæäº¤ ${success.length} æ¡å¿«é€’ âœ…`);
  });
}
function deleteExpressCache(index) {
  let list = JSON.parse(localStorage.getItem(EXPRESS_CACHE_KEY) || "[]");
  list.splice(index, 1);
  localStorage.setItem(EXPRESS_CACHE_KEY, JSON.stringify(list));
  previewExpressCache();
}
function editExpressCache(index) {
  const list = JSON.parse(localStorage.getItem(EXPRESS_CACHE_KEY) || "[]");
  const item = list[index];
  if (!item) return;
  setField("customer", item.customer);
  setField("orderNumber", item.orderNumber);
  setField("trackingNumber", item.trackingNumber);
  setField("company", item.company);
  setField("product", item.product);
  setField("quantity", item.quantity);
  setField("price", item.price);
  setField("foreignShipping", item.foreignShipping);
  deleteExpressCache(index);
  closeExpressModal();
}
function exportCache(key) {
  const data = localStorage.getItem(key) || "[]";
  const blob = new Blob([data], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `${key}.json`;
  a.click();
}
function importCache(event, key) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      if (!Array.isArray(imported)) throw new Error("æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®");
      const existing = JSON.parse(localStorage.getItem(key) || "[]");
      const merged = existing.concat(imported);
      localStorage.setItem(key, JSON.stringify(merged));
      alert(`å¯¼å…¥æˆåŠŸï¼Œå…±åˆå¹¶ ${imported.length} æ¡è®°å½• âœ…`);
    } catch (err) {
      alert("å¯¼å…¥å¤±è´¥ï¼š" + err.message);
    }
  };
  reader.readAsText(file);
}
function uploadCachedOrders() {
  const list = JSON.parse(localStorage.getItem(ORDER_CACHE_KEY) || "[]");
  if (!list.length) return alert("æ²¡æœ‰è®¢å•è‰ç¨¿");
  fetch(ORDER_URL + "?uploadCache=1", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(list)
  }).then(res => res.json()).then(r => alert(r.message || "è®¢å•è‰ç¨¿ä¸Šä¼ æˆåŠŸ âœ…"))
    .catch(() => alert("ä¸Šä¼ å¤±è´¥"));
}
function uploadCachedExpress() {
  const list = JSON.parse(localStorage.getItem(EXPRESS_CACHE_KEY) || "[]");
  if (!list.length) return alert("æ²¡æœ‰å¿«é€’è‰ç¨¿");
  fetch(EXPRESS_URL + "?uploadCache=1", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(list)
  }).then(res => res.json()).then(r => alert(r.message || "å¿«é€’è‰ç¨¿ä¸Šä¼ æˆåŠŸ âœ…"))
    .catch(() => alert("ä¸Šä¼ å¤±è´¥"));
}
function downloadCachedOrders() {
  fetch(ORDER_URL + "?downloadCache=1")
    .then(res => res.json())
    .then(list => {
      const local = JSON.parse(localStorage.getItem(ORDER_CACHE_KEY) || "[]");
      const merged = local.concat(list);
      localStorage.setItem(ORDER_CACHE_KEY, JSON.stringify(merged));
      alert(`å·²ä¸‹è½½ ${list.length} æ¡è®¢å•è‰ç¨¿ âœ…`);
    }).catch(() => alert("ä¸‹è½½å¤±è´¥"));
}
function downloadCachedExpress() {
  fetch(EXPRESS_URL + "?downloadCache=1")
    .then(res => res.json())
    .then(list => {
      const local = JSON.parse(localStorage.getItem(EXPRESS_CACHE_KEY) || "[]");
      const merged = local.concat(list);
      localStorage.setItem(EXPRESS_CACHE_KEY, JSON.stringify(merged));
      alert(`å·²ä¸‹è½½ ${list.length} æ¡å¿«é€’è‰ç¨¿ âœ…`);
    }).catch(() => alert("ä¸‹è½½å¤±è´¥"));
}
function submitAllOrderCache() {
  const cache = JSON.parse(localStorage.getItem(ORDER_CACHE_KEY) || "[]");
  if (!cache.length) return alert("æ²¡æœ‰å¯æäº¤çš„è®¢å•ç¼“å­˜");
  const promises = cache.map(item => {
    const { subtotal, total } = calculateTotal(
      parseOrZero(item.quantity),
      parseOrZero(item.price),
      parseOrZero(item.foreignShipping),
      item.customer
    );
    const payload = {
      customer: item.customer,
      values: [
        item.customer,
        item.orderNumber,
        item.trackingNumber,
        item.product,
        item.quantity,
        item.price,
        item.foreignShipping,
        subtotal,
        total
      ]
    };
    return fetch(ORDER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  });
  Promise.all(promises).then(() => {
    localStorage.removeItem(ORDER_CACHE_KEY);
    fetch(ORDER_URL + "?clearDraft=1").then(() => {
      alert("âœ… æ‰€æœ‰è®¢å•å·²æ‰¹é‡æäº¤å¹¶æ¸…é™¤ç¼“å­˜");
    });
  });
}
function submitAllExpressCache() {
  const cache = JSON.parse(localStorage.getItem(EXPRESS_CACHE_KEY) || "[]");
  if (!cache.length) return alert("æ²¡æœ‰å¯æäº¤çš„å¿«é€’ç¼“å­˜");
  const promises = cache.map(item => {
    const { total } = calculateTotal(
      parseOrZero(item.quantity),
      parseOrZero(item.price),
      parseOrZero(item.foreignShipping),
      item.customer
    );
    const payload = {
      customer: item.customer,
      values: [
        item.customer,
        item.orderNumber,
        item.trackingNumber,
        item.company,
        item.product,
        item.quantity,
        item.price,
        item.foreignShipping,
        total
      ]
    };
    return fetch(EXPRESS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  });
  Promise.all(promises).then(() => {
    localStorage.removeItem(EXPRESS_CACHE_KEY);
    fetch(EXPRESS_URL + "?clearDraft=1").then(() => {
      alert("âœ… æ‰€æœ‰å¿«é€’å·²æ‰¹é‡æäº¤å¹¶æ¸…é™¤ç¼“å­˜");
    });
  });
}
</script>


</body>
</html>
